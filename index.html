<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EMI Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, button, select { margin: 5px; padding: 5px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h2>EMI Calculator (with Broken Period Interest)</h2>

  <label>Loan Amount (₹): <input type="number" id="loanAmount" /></label><br />
  <label>Interest Type:
    <select id="interestType">
      <option value="reducing">Reducing</option>
      <option value="flat">Flat</option>
    </select>
  </label><br />
  <label>Annual Interest Rate (%): <input type="number" id="annualRate" step="0.01" /></label><br />
  <label>Gross Tenure (months): <input type="number" id="grossTenure" /></label><br />
  <label>Advance EMI (count): <input type="number" id="advanceEMI" /></label><br />
  <label>Disbursal Date: <input type="date" id="disbursalDate" /></label><br />
  <label>First EMI Date: <input type="date" id="firstEmiDate" /></label><br />
  <button onclick="calculateEMI()">Calculate</button>

  <div id="results"></div>
  <div id="schedule"></div>

  <script>
    function calculateEMI() {
      const P = parseFloat(document.getElementById("loanAmount").value);
      const interestType = document.getElementById("interestType").value;
      const annualRate = parseFloat(document.getElementById("annualRate").value);
      const R = annualRate / 1200;
      const grossTenure = parseInt(document.getElementById("grossTenure").value);
      const advanceEMI = parseInt(document.getElementById("advanceEMI").value);
      const disbursalDate = new Date(document.getElementById("disbursalDate").value);
      const firstEmiDate = new Date(document.getElementById("firstEmiDate").value);
      const netTenure = grossTenure - advanceEMI;

      const timeDiff = Math.abs(firstEmiDate - disbursalDate);
      const brokenPeriodDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
      const brokenInterest = (P * (annualRate / 100) * brokenPeriodDays) / 365;

      let EMI;
      if (interestType === "reducing") {
        EMI = P * R * Math.pow(1 + R, netTenure) / (Math.pow(1 + R, netTenure) - 1);
      } else {
        const flatInterest = (P * (annualRate / 100) * grossTenure) / 12 / grossTenure;
        EMI = (P / grossTenure) + flatInterest;
      }

      const firstEMI = EMI + brokenInterest;

      const lastEmiDate = new Date(firstEmiDate);
      lastEmiDate.setMonth(lastEmiDate.getMonth() + netTenure - 1);

      let html = `
        <h3>Loan Summary</h3>
        <p>Interest Type: ${interestType}</p>
        <p>Net Tenure: ${netTenure} months</p>
        <p>Broken Period Interest: ₹${brokenInterest.toFixed(2)}</p>
        <p>Regular EMI: ₹${EMI.toFixed(2)}</p>
        <p>First EMI (with Broken Interest): ₹${firstEMI.toFixed(2)}</p>
        <p>Last EMI Date: ${lastEmiDate.toDateString()}</p>
      `;
      document.getElementById("results").innerHTML = html;

      let balance = P;
      let schedule = `
        <h3>Amortization Schedule</h3>
        <table>
          <tr><th>Month</th><th>Principal</th><th>Interest</th><th>EMI</th><th>Balance</th></tr>
      `;

      for (let i = 0; i < netTenure; i++) {
        let interest, principal;
        if (interestType === "reducing") {
          interest = balance * R;
          principal = EMI - interest;
          balance -= principal;
        } else {
          interest = (P * (annualRate / 100)) / 12;
          principal = P / grossTenure;
          balance -= principal;
        }

        schedule += `<tr><td>${i + 1}</td><td>${principal.toFixed(2)}</td><td>${interest.toFixed(2)}</td><td>${EMI.toFixed(2)}</td><td>${Math.max(0, balance.toFixed(2))}</td></tr>`;
      }

      schedule += `</table>`;
      document.getElementById("schedule").innerHTML = schedule;
    }
  </script>
</body>
</html>
